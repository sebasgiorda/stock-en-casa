<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockEnCasa | YouTube Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        
        body { font-family: 'Roboto', sans-serif; transition: background 0.2s; }

        /* Estilo YouTube Light */
        .light-theme { background-color: #ffffff; color: #0f0f0f; }
        .light-card { background: #f2f2f2; border: none; }
        .light-card:hover { background: #e5e5e5; }
        .light-sidebar-item:hover { background: #f2f2f2; }

        /* Estilo YouTube Dark */
        .dark-theme { background-color: #0f0f0f; color: #ffffff; }
        .dark-card { background: #272727; border: none; }
        .dark-card:hover { background: #3f3f3f; }
        .dark-sidebar-item:hover { background: #272727; }

        .btn-pill { border-radius: 40px; transition: all 0.2s; }
        .active-filter { background: #0f0f0f; color: white; }
        .dark-theme .active-filter { background: white; color: #0f0f0f; }

        /* Scrollbar estilo moderno */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        
        .modal-blur { backdrop-filter: rgba(0,0,0,0.6); }
    </style>
</head>
<body class="light-theme">

    <div class="flex h-screen overflow-hidden">
        <aside id="sidebar" class="w-20 lg:w-60 flex flex-col p-2 h-full transition-colors overflow-y-auto">
            <div class="flex items-center gap-4 px-4 py-4 mb-4">
                <i data-lucide="menu" class="cursor-pointer"></i>
                <h1 class="text-xl font-bold tracking-tighter hidden lg:block">StockEnCasa</h1>
            </div>
            
            <nav class="space-y-1" id="nav-categories">
                </nav>

            <div class="mt-auto p-2">
                <button onclick="toggleTheme()" class="w-full flex items-center gap-4 p-3 rounded-xl light-sidebar-item dark-sidebar-item transition-all">
                    <i data-lucide="moon" id="theme-icon"></i>
                    <span class="hidden lg:block font-medium">Aspecto</span>
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col h-full overflow-y-auto">
            <header class="sticky top-0 z-10 p-4 bg-inherit flex flex-col gap-4">
                <div class="flex justify-between items-center px-4">
                    <div class="relative w-full max-w-xl hidden md:block">
                        <input type="text" placeholder="Buscar productos..." class="w-full py-2 px-10 rounded-full border border-gray-300 dark:border-zinc-700 bg-transparent outline-none focus:border-blue-500">
                        <i data-lucide="search" class="absolute left-3 top-2.5 w-5 h-5 text-gray-400"></i>
                    </div>
                    <button onclick="openModal()" class="btn-pill bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 font-medium flex items-center gap-2">
                        <i data-lucide="plus" class="w-5 h-5"></i> Crear
                    </button>
                </div>

                <div id="filter-bar" class="flex gap-3 px-4 py-2 overflow-x-auto no-scrollbar">
                    </div>
            </header>

            <div id="grid-productos" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 p-6">
                </div>
        </main>
    </div>

    <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60">
        <div class="bg-white dark:bg-[#212121] w-full max-w-md p-6 rounded-xl shadow-2xl">
            <h3 class="text-xl font-bold mb-6" id="modal-title">Nuevo Producto</h3>
            <div class="space-y-4">
                <input type="text" id="in-nombre" placeholder="Nombre" class="w-full bg-transparent border-b border-gray-300 dark:border-zinc-700 py-2 outline-none focus:border-blue-500">
                <input type="text" id="in-marca" placeholder="Marca" class="w-full bg-transparent border-b border-gray-300 dark:border-zinc-700 py-2 outline-none focus:border-blue-500">
                <select id="in-categoria" class="w-full bg-transparent border-b border-gray-300 dark:border-zinc-700 py-2 outline-none">
                    <option value="Almacén">Almacén</option>
                    <option value="Limpieza">Limpieza</option>
                    <option value="Higiene">Higiene</option>
                    <option value="Bebidas">Bebidas</option>
                </select>
                <div class="flex gap-4">
                    <input type="number" id="in-cantidad" placeholder="Cantidad" class="flex-1 bg-transparent border-b border-gray-300 dark:border-zinc-700 py-2 outline-none">
                    <input type="number" id="in-minimo" placeholder="Mínimo" class="flex-1 bg-transparent border-b border-gray-300 dark:border-zinc-700 py-2 outline-none">
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-8">
                <button onclick="closeModal()" class="px-4 py-2 font-medium hover:bg-gray-100 dark:hover:bg-zinc-800 rounded-full">Cancelar</button>
                <button onclick="guardarCambios()" class="px-4 py-2 bg-blue-600 text-white rounded-full font-medium hover:bg-blue-700">Guardar</button>
            </div>
        </div>
    </div>

    <script>
        const SB_URL = "https://visqrgjfpatplqtasexd.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZpc3FyZ2pmcGF0cGxxdGFzZXhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NDQ1NTEsImV4cCI6MjA4MjUyMDU1MX0.6oYSY3GckwYHdy39VpJXjUlVorez90ElUXRFRU0rX4o"; // REEMPLAZAR
        const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

        let currentFilter = 'Todos';
        const categorias = ['Todos', 'Almacén', 'Limpieza', 'Higiene', 'Bebidas'];

        function toggleTheme() {
            const b = document.body;
            b.classList.toggle('light-theme');
            b.classList.toggle('dark-theme');
            lucide.createIcons();
        }

        async function cargarStock() {
            let query = supabaseClient.from('productos').select('*').order('nombre');
            if(currentFilter !== 'Todos') query = query.eq('categoria', currentFilter);
            
            const { data } = await query;
            const grid = document.getElementById('grid-productos');
            grid.innerHTML = data.map(p => `
                <div class="flex flex-col gap-3 group cursor-pointer">
                    <div class="aspect-video rounded-xl relative overflow-hidden ${document.body.classList.contains('dark-theme') ? 'dark-card' : 'light-card'} flex items-center justify-center">
                        <i data-lucide="package" class="w-12 h-12 opacity-20"></i>
                        <div class="absolute bottom-2 right-2 bg-black/80 text-white text-xs px-2 py-1 rounded font-bold">
                            Stock: ${p.cantidad}
                        </div>
                    </div>
                    <div class="flex gap-3 px-1">
                        <div class="w-9 h-9 rounded-full bg-blue-600 flex-shrink-0 flex items-center justify-center text-white font-bold">
                            ${p.nombre[0]}
                        </div>
                        <div class="flex flex-col flex-1">
                            <h4 class="font-bold line-clamp-2">${p.nombre}</h4>
                            <p class="text-sm text-gray-500 dark:text-zinc-400">${p.marca} • ${p.categoria}</p>
                            <div class="mt-2 flex items-center gap-2">
                                <button onclick="updateQty(${p.id}, ${p.cantidad - 1})" class="p-1 hover:bg-gray-200 dark:hover:bg-zinc-700 rounded">-</button>
                                <span class="text-xs font-bold ${p.cantidad <= p.stock_minimo ? 'text-red-500' : ''}">${p.cantidad <= p.stock_minimo ? 'STOCK BAJO' : 'DISPONIBLE'}</span>
                                <button onclick="updateQty(${p.id}, ${p.cantidad + 1})" class="p-1 hover:bg-gray-200 dark:hover:bg-zinc-700 rounded">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        async function updateQty(id, val) {
            if(val < 0) return;
            await supabaseClient.from('productos').update({ cantidad: val }).eq('id', id);
            cargarStock();
        }

        // Barra de Filtros estilo YT Chips
        function renderFilters() {
            const bar = document.getElementById('filter-bar');
            bar.innerHTML = categorias.map(c => `
                <button onclick="setFilter('${c}')" class="px-4 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${currentFilter === c ? 'bg-black text-white dark:bg-white dark:text-black' : 'bg-gray-100 dark:bg-zinc-800 hover:bg-gray-200 dark:hover:bg-zinc-700'}">
                    ${c}
                </button>
            `).join('');
        }

        function setFilter(c) {
            currentFilter = c;
            renderFilters();
            cargarStock();
        }

        function openModal() { document.getElementById('modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        async function guardarCambios() {
            const p = {
                nombre: document.getElementById('in-nombre').value,
                marca: document.getElementById('in-marca').value,
                categoria: document.getElementById('in-categoria').value,
                cantidad: parseInt(document.getElementById('in-cantidad').value),
                stock_minimo: parseInt(document.getElementById('in-minimo').value)
            };
            await supabaseClient.from('productos').insert([p]);
            closeModal();
            cargarStock();
        }

        window.onload = () => { renderFilters(); cargarStock(); lucide.createIcons(); };
    </script>
</body>
</html>
